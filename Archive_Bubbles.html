<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Crucial for mobile: prevents zooming and sets correct scale -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BNET Speed Challenge</title>
    
    <!-- Google Font for Gaming Look -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --bnet-cyan: #00f3ff;
            --bnet-blue: #0066ff;
            --lag-red: #ff2a2a;
            --bg-dark: #050510;
            --glass: rgba(20, 20, 40, 0.7);
            --font-gaming: 'Orbitron', sans-serif;
            --font-ui: 'Roboto', sans-serif;
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-dark);
            /* Cyberpunk Grid Background */
            background-image: 
                linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            color: white;
            font-family: var(--font-ui);
            overflow: hidden;
            height: 100vh; /* Fallback */
            height: 100dvh; /* Mobile dynamic height */
            display: flex;
            flex-direction: column;
            touch-action: none;
        }

        /* --- TOP BAR --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            padding-top: max(15px, env(safe-area-inset-top)); /* Notch support */
            background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%);
            z-index: 10;
        }

        /* Logo Styling */
        .logo-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Replace this .logo-text with <img src="logo.png"> if you have a file */
        .logo-text {
            font-family: var(--font-gaming);
            font-weight: 900;
            font-size: 1.5rem;
            letter-spacing: 2px;
            background: linear-gradient(45deg, var(--bnet-cyan), var(--bnet-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 5px var(--bnet-cyan));
        }

        .timer-box {
            font-family: var(--font-gaming);
            font-size: 1.2rem;
            color: white;
            text-shadow: 0 0 10px var(--bnet-cyan);
        }

        /* --- NETWORK TOGGLE (The Hero Feature) --- */
        .control-bar {
            display: flex;
            justify-content: center;
            padding: 10px;
            z-index: 10;
        }

        .network-switch {
            position: relative;
            display: flex;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 4px;
            cursor: pointer;
            width: 320px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .switch-bg {
            position: absolute;
            top: 4px; left: 4px; bottom: 4px;
            width: calc(50% - 4px);
            border-radius: 24px;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* States for the switch background */
        .mode-bnet .switch-bg {
            background: linear-gradient(90deg, var(--bnet-blue), var(--bnet-cyan));
            transform: translateX(100%);
            box-shadow: 0 0 20px var(--bnet-cyan);
        }
        .mode-lag .switch-bg {
            background: var(--lag-red);
            transform: translateX(0%);
            box-shadow: 0 0 20px var(--lag-red);
        }

        .switch-label {
            flex: 1;
            text-align: center;
            padding: 10px 0;
            font-size: 0.85rem;
            font-weight: 700;
            z-index: 2;
            color: rgba(255,255,255,0.5);
            transition: color 0.3s;
            text-transform: uppercase;
        }

        .mode-bnet .label-bnet { color: #000; }
        .mode-lag .label-lag { color: white; }

        /* --- GAME AREA --- */
        #game-area {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .target {
            position: absolute;
            width: 75px;
            height: 75px;
            border-radius: 50%;
            /* Complex gradient for 3D look */
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9) 0%, var(--bnet-cyan) 20%, var(--bnet-blue) 100%);
            box-shadow: 0 0 15px var(--bnet-cyan), inset 0 0 10px rgba(255,255,255,0.5);
            transform: translate(-50%, -50%) scale(0);
            animation: spawnPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            z-index: 5;
            cursor: pointer;
        }

        /* Lagged Target Appearance (Visual cue it's lagging) */
        .target.lagging {
            filter: grayscale(100%);
            border: 2px solid var(--lag-red);
        }

        .ripple {
            position: absolute;
            width: 10px; height: 10px;
            background: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: rippleAnim 0.4s linear forwards;
            pointer-events: none;
            z-index: 4;
        }

        .score-float {
            position: absolute;
            color: var(--bnet-cyan);
            font-family: var(--font-gaming);
            font-weight: bold;
            font-size: 1.5rem;
            pointer-events: none;
            animation: floatUp 0.8s ease-out forwards;
            z-index: 6;
            text-shadow: 0 0 5px var(--bnet-cyan);
        }

        /* --- OVERLAYS (Start / End) --- */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5, 5, 16, 0.85);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-family: var(--font-gaming);
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #fff, var(--bnet-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        p { color: #aaa; line-height: 1.6; margin-bottom: 30px; max-width: 400px;}

        .btn-primary {
            background: linear-gradient(90deg, var(--bnet-blue), var(--bnet-cyan));
            border: none;
            padding: 18px 50px;
            font-family: var(--font-gaming);
            font-size: 1.2rem;
            color: black;
            font-weight: 900;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 0 25px var(--bnet-blue);
            transition: transform 0.1s;
            text-transform: uppercase;
        }
        .btn-primary:active { transform: scale(0.95); }

        .hidden { display: none !important; }

        /* Animations */
        @keyframes spawnPop { to { transform: translate(-50%, -50%) scale(1); } }
        @keyframes rippleAnim { 
            0% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
            100% { transform: translate(-50%, -50%) scale(8); opacity: 0; }
        }
        @keyframes floatUp {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
            100% { transform: translate(-50%, -150%) scale(1.2); opacity: 0; }
        }

    </style>
</head>
<body class="mode-bnet">

    <!-- HEADER -->
    <header>
        <div class="logo-container">
            <!-- Replace with: <img src="bnet-logo.png" height="30"> -->
            <div class="logo-text">BNET</div> 
        </div>
        <div class="timer-box" id="timer">30.0s</div>
    </header>

    <!-- NETWORK TOGGLE -->
    <div class="control-bar">
        <div class="network-switch" onclick="toggleNetwork()">
            <div class="switch-bg"></div>
            <div class="switch-label label-lag">
                ⚠️ Others (300ms)
            </div>
            <div class="switch-label label-bnet">
                ⚡ BNET (3ms)
            </div>
        </div>
    </div>

    <!-- GAME AREA -->
    <div id="game-area"></div>

    <!-- START SCREEN -->
    <div id="start-screen" class="overlay">
        <h1>LATENCY TEST</h1>
        <p>Experience the BNET advantage.<br>Tap the targets as fast as possible.</p>
        <button class="btn-primary" onclick="startGame()">START DEMO</button>
    </div>

    <!-- GAME OVER SCREEN -->
    <div id="end-screen" class="overlay hidden">
        <h1 id="final-score-title">0 PTS</h1>
        <p>Switching between networks shows how speed impacts performance.</p>
        <div style="display:flex; gap:10px; flex-direction:column; width:100%;">
             <button class="btn-primary" onclick="startGame()">RETRY</button>
        </div>
    </div>

    <script>
        // Game State
        let score = 0;
        let timeLeft = 30;
        let isPlaying = false;
        let isBNET = true; // True = Fast, False = Lag
        let gameLoop;
        let spawnLoop;
        
        // DOM Elements
        const body = document.body;
        const gameArea = document.getElementById('game-area');
        const timerEl = document.getElementById('timer');
        const startScreen = document.getElementById('start-screen');
        const endScreen = document.getElementById('end-screen');
        const finalScoreTitle = document.getElementById('final-score-title');

        // 1. Toggle Logic
        function toggleNetwork() {
            isBNET = !isBNET;
            if(isBNET) {
                body.classList.remove('mode-lag');
                body.classList.add('mode-bnet');
            } else {
                body.classList.remove('mode-bnet');
                body.classList.add('mode-lag');
            }
        }

        // 2. Start Game
        function startGame() {
            // Reset
            score = 0;
            timeLeft = 30.0;
            gameArea.innerHTML = '';
            isPlaying = true;
            
            // UI Updates
            startScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            timerEl.innerText = "30.0s";
            
            // Ensure we start in BNET mode for best first impression (optional)
            if(!isBNET) toggleNetwork(); 

            // Loops
            spawnTarget();
            gameLoop = setInterval(updateTime, 100);
            spawnLoop = setInterval(spawnTarget, 550);
        }

        // 3. Timer Logic
        function updateTime() {
            timeLeft -= 0.1;
            timerEl.innerText = timeLeft.toFixed(1) + "s";
            
            if (timeLeft <= 0) {
                endGame();
            }
        }

        // 4. Spawn Logic
        function spawnTarget() {
            if(!isPlaying) return;

            const target = document.createElement('div');
            target.classList.add('target');
            
            // Safe area math (padding 20px from edges)
            const maxX = gameArea.clientWidth - 75;
            const maxY = gameArea.clientHeight - 75;
            const x = Math.random() * maxX + 37.5; // center offset
            const y = Math.random() * maxY + 37.5;

            target.style.left = x + 'px';
            target.style.top = y + 'px';

            // Touch handling
            target.addEventListener('pointerdown', (e) => handleHit(e, target));

            gameArea.appendChild(target);

            // Auto-remove if too slow
            setTimeout(() => {
                if(target.parentNode) {
                    target.style.transform = "translate(-50%, -50%) scale(0)";
                    target.style.opacity = "0";
                    setTimeout(() => target.remove(), 300);
                }
            }, 1500);
        }

        // 5. Hit Logic (The Core Magic)
        function handleHit(e, target) {
            e.preventDefault(); // Stop defaults
            
            // A. Instant Visual Feedback (The user touched the screen)
            createRipple(e.clientX, e.clientY);

            // B. Calculate Latency
            // If BNET: 3ms delay (imperceptible)
            // If Lag: 300ms delay (painful)
            const delay = isBNET ? 3 : 300;

            // C. Simulation
            setTimeout(() => {
                if(target.parentNode) {
                    // Success Animation
                    target.remove();
                    score += 10;
                    showFloatingScore(e.clientX, e.clientY);
                    
                    // Optional: Vibration feedback if supported
                    if(navigator.vibrate && isBNET) navigator.vibrate(5); 
                }
            }, delay);
        }

        // Visual FX: Ripple where finger touches
        function createRipple(x, y) {
            const ripple = document.createElement('div');
            ripple.classList.add('ripple');
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            gameArea.appendChild(ripple);
            setTimeout(() => ripple.remove(), 500);
        }

        // Visual FX: Score popup
        function showFloatingScore(x, y) {
            const float = document.createElement('div');
            float.classList.add('score-float');
            float.innerText = "+10";
            float.style.left = x + 'px';
            float.style.top = y + 'px';
            gameArea.appendChild(float);
            setTimeout(() => float.remove(), 800);
        }

        // 6. End Game
        function endGame() {
            isPlaying = false;
            clearInterval(gameLoop);
            clearInterval(spawnLoop);
            finalScoreTitle.innerText = score + " PTS";
            endScreen.classList.remove('hidden');
        }
    </script>
</body>
</html>
